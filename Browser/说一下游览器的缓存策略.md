# **说一下游览器的缓存策略**

浏览器的缓存策略是提高网页加载速度和减轻服务器负担的重要手段。这些策略主要通过HTTP响应头中的特定字段来实现，如Cache-Control、Expires、Last-Modified和ETag等。以下是对浏览器缓存策略的详细解释：

 **一、强制缓存** 

强制缓存是指浏览器在本地缓存中查找请求的资源，并根据缓存规则决定是否直接使用缓存副本的过程。这主要通过以下两个字段来控制：

1. Expires：

- 这是一个绝对时间，表示资源缓存的到期时间。
- 如果客户端的时间小于Expires的值，浏览器会直接使用缓存结果。
- 但Expires存在一个问题：服务器时间与客户端时间可能不一致，导致缓存失效。

1. Cache-Control：

- 这是HTTP/1.1中引入的重要缓存控制字段，用于定义缓存的策略和指令。
- 常用的值包括public（所有内容都将被缓存）、no-store（所有内容都不会被缓存）、max-age=xxx（缓存内容将在xxx秒后失效）等。

○当同时存在Cache-Control和Expires时，浏览器总是优先使用Cache-Control。

 **二、协商缓存** 

协商缓存是在强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程。这主要通过以下两个字段来控制：

1Last-Modified / If-Modified-Since：

○Last-Modified是服务器响应请求时返回的资源文件在服务器最后被修改的时间。

○当浏览器再次请求该资源时，会在请求头中携带If-Modified-Since字段，其值为上次请求时服务器返回的Last-Modified值。

○服务器通过比较这两个时间值来决定是否返回304状态码（资源未修改，使用缓存）或200状态码（资源已修改，返回新资源）。

2ETag / If-None-Match：

○ETag是服务器响应请求时返回的资源文件的唯一标识。

○当浏览器再次请求该资源时，会在请求头中携带If-None-Match字段，其值为上次请求时服务器返回的ETag值。

○服务器通过比较这两个值来决定是否返回304状态码或200状态码。

 **三、其他缓存策略** 

除了上述的强制缓存和协商缓存外，还有一些其他的缓存策略和技术，如：

●Service Worker：可以实现更灵活的缓存控制，包括离线运行和更细粒度的缓存策略定义。

●CDN（内容分发网络）：将静态资源缓存在离用户较近的服务器节点上，以加快资源加载速度。

●localStorage和sessionStorage：用于在客户端存储动态数据，这些数据可以在页面刷新后依然保持，减少了对服务器的请求。



 总结 

强缓存策略和协商缓存策略在缓存命中时都会直接使用本地的缓存副本，区别只在于协商缓存会向服务器发送一次请求。它们缓存不命中时，都会向服务器发送请求来获取资源。在实际的缓存机制中，强缓存策略和协商缓存策略是一起合作使用的。浏览器首先会根据请求的信息判断，强缓存是否命中，如果命中则直接使用资源。如果不命中则根据头信息向服务器发起请求，使用协商缓存，如果协商缓存命中的话，则服务器不返回资源，浏览器直接使用本地资源的副本，如果协商缓存不命中，则浏览器返回最新的资源给浏览器。

